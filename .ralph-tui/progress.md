# Ralph Progress Log

This file tracks progress across iterations. Agents update this file
after each iteration and it's included in prompts for context.

## Codebase Patterns (Study These First)

- **nodenext + Jest**: When using `module: "nodenext"` with `.js` extensions in imports, Jest/ts-jest needs `moduleNameMapper: { '^(\\.{1,2}/.*)\\.js$': '$1' }` to resolve `.js` back to `.ts` files.
- **Webpack 4 + ES2022 target**: Webpack 4's parser (acorn 6.x) only supports up to ES2019 syntax. Use a separate `tsconfig.webpack.json` with `target: "ES2017"` and configure ts-loader's `configFile` option. Also need `NODE_OPTIONS=--openssl-legacy-provider` for the MD4 hash issue.
- **Hoisted types in Yarn workspaces**: With `node-modules` linker, `@types/*` packages are hoisted to root `node_modules/@types`. Package tsconfig `typeRoots` must point to `../node_modules/@types` (relative to package dir) to find them.
- **express-openapi-validator v5**: Expects `apiSpec` to be a file path or parsed object, NOT a YAML string content. Passing file content as string causes "spec could not be read" errors.
- **ESLint v9 flat config in monorepos**: Use a single root `eslint.config.mjs` with file-pattern-based config objects instead of per-package `.eslintrc` files. CommonJS config files (jest.config.js, etc.) need `globals.node` + `globals.commonjs` to avoid `no-undef` errors for `module`, `require`, `__dirname`.
- **ESLint v9 + lint-staged**: In lint-staged, use `eslint --no-warn-ignored` flag and match only lintable file extensions (`**/*.{ts,tsx,js,mjs}`) instead of running `eslint .` on all files.
- **Vitest + nodenext**: Vitest natively handles `.js` -> `.ts` module resolution via Vite, unlike Jest/ts-jest which needs `moduleNameMapper`. Use explicit imports (`import { describe, it, expect } from 'vitest'`) instead of globals for cleaner type safety.
- **tsx watch for dev mode**: `tsx watch --clear-screen=false -r dotenv/config src/index.ts` replaces nodemon + ts-node with zero config (no nodemon.json needed).
- **Vite tsconfig for SPA**: When migrating from SSR Webpack to Vite SPA, use `module: "ESNext"`, `moduleResolution: "bundler"`, `jsx: "react-jsx"`. Remove `rootDir` constraint so config files at project root can be included. Remove `outDir` since Vite handles bundling.
- **Vitest + @vitejs/plugin-react type mismatch**: When vitest bundles a different Vite version than the installed `vite` package, `@vitejs/plugin-react` types conflict. Use `defineConfig` from `vitest/config` with `react() as any` cast to resolve.
- **@testing-library/react + Vitest cleanup**: With `globals: false` in Vitest, `@testing-library/react` doesn't auto-detect the framework for cleanup. Add explicit `afterEach(() => { cleanup(); })` in setupTests.ts.
- **React 19 + ESLint**: React 19 with `jsx: "react-jsx"` doesn't require `import React` - add `'react/react-in-jsx-scope': 'off'` to ESLint config for React files.
- **@testing-library/dom in Yarn workspaces**: `@testing-library/react` depends on `@testing-library/dom` as a peer dep. With Yarn 3 strict hoisting, it must be explicitly added to devDependencies or TypeScript can't resolve `screen` export.
- **Tailwind CSS v4 + Vite**: Use `@tailwindcss/vite` plugin instead of PostCSS config. Theme is configured in CSS via `@theme {}` block (no `tailwind.config.js`). Dark mode uses `@custom-variant dark (&:is(.dark *))` with a `.dark` class on the root element.
- **shadcn/ui with Tailwind v4**: No `tailwind.config.js` needed. Define CSS custom properties (e.g., `--color-primary`, `--color-border`) in `@theme {}` and override in `.dark {}` selector. Components use `cn()` utility from `clsx` + `tailwind-merge`.
- **jsx-a11y/heading-has-content + forwardRef**: When using `forwardRef` with spread props on heading elements (`<h3 {...props} />`), `jsx-a11y/heading-has-content` can't detect that children are passed via spread. Fix by explicitly destructuring and rendering `{children}`.
- **Path aliases in Vite + Vitest**: When using `@/` path alias, configure it in BOTH `vite.config.ts` (via `resolve.alias`) AND `vitest.config.ts` (separate alias config) AND `tsconfig.json` (via `baseUrl` + `paths`). Vitest uses its own config, not the main Vite config.
- **Storybook v8 + Vite + Tailwind CSS v4**: Use `@storybook/react-vite` framework. Import the app's CSS (with `@import 'tailwindcss'` and `@theme {}`) in `preview.ts` so Tailwind styles apply to stories. Configure `@/` path alias in `viteFinal` within `.storybook/main.ts`. Storybook's Vite builder picks up `@tailwindcss/vite` automatically if it's in the app's Vite config dependencies.
- **Storybook v8 in monorepos with Yarn workspaces**: When old `.storybook/main.js` exists alongside new `main.ts`, Storybook loads `.js` first and ignores `.ts`. Always remove legacy config files when upgrading.
- **window.matchMedia in jsdom/Vitest**: jsdom doesn't implement `window.matchMedia`. When components use `prefers-color-scheme` media queries (e.g., theme detection), add a mock in `setupTests.ts` using `Object.defineProperty(window, 'matchMedia', { writable: true, value: vi.fn().mockImplementation(...) })`.
- **Jest to Vitest migration checklist**: Replace `jest.fn()` with `vi.fn()`, `jest.spyOn` with `vi.spyOn`, `jest.restoreAllMocks()` with `vi.restoreAllMocks()`, add explicit imports from `vitest`, replace `done` callback pattern with `return new Promise<void>()`, and remove `@types/jest`, `ts-jest`, `jest` deps.
- **Vitest workspace for monorepos**: Create `vitest.workspace.ts` at root using `defineWorkspace()` from `vitest/config` pointing to each package's `vitest.config.ts`. Each package still runs tests independently via `vitest run` in its own scripts.
- **Playwright E2E in monorepos**: Install `@playwright/test` at root level. Use `webServer` array in `playwright.config.ts` to start both frontend (Vite) and backend (Express) before tests. Service needs `bundle:api &&` prefix if it depends on bundled API spec. Use `-- --no-open` flag for Vite to prevent browser auto-open during E2E runs.
- **Vite proxy for API calls**: When web-app fetches `/api/*` and the service runs on a different port, add `server.proxy` in `vite.config.ts` to forward requests: `'/api': { target: 'http://localhost:4000', changeOrigin: true }`.
- **Autocannon percentiles**: Autocannon provides p50, p75, p90, p97_5, p99 (no p95). Use `p97_5` as the closest approximation when testing against p95 thresholds. The `@types/autocannon` Histogram interface defines `p97_5` not `p95`.
- **Vitest perf test isolation**: Use a separate `vitest.perf.config.ts` with `include: ['tests/performance/**/*.perf.test.ts']` and add `exclude: ['tests/performance/**']` to the main `vitest.config.ts` so performance tests don't run during `yarn test`. Run them via `yarn test:perf` which references the separate config.

---

## 2026-02-13 - US-002
- What was implemented:
  - Updated .nvmrc from 14.17.0 to 22.13.1 (Node 22 LTS)
  - Updated engines field to `>= 22` in root and express-app package.json
  - Upgraded TypeScript from 4.3.4 to ^5.7.3 (resolved to 5.9.3) across all packages
  - Upgraded @types/node to ^22.13.0 in root and web-app
  - Created shared `tsconfig.base.json` at root with modern options (target: ES2022, module: nodenext, moduleResolution: nodenext)
  - Updated all package tsconfigs to extend from tsconfig.base.json
  - Added `.js` extensions to all relative imports in service/ and packages/express-app/ for nodenext compatibility
  - Created `tsconfig.webpack.json` for web-app's Webpack 4 build (targets ES2017)
  - Updated webpack.config.js to use tsconfig.webpack.json via ts-loader configFile option
  - Added `typecheck` script (`tsc --noEmit`) to root and all 3 packages
  - Upgraded service Jest from 27.x to 29.x (27.x incompatible with Node 22)
  - Upgraded service @types/jest, @types/supertest, ts-jest to match
  - Added `moduleNameMapper` to Jest configs for .js -> .ts resolution
  - Fixed express-openapi-validator v5 bug (was passing YAML string instead of file path)
  - Added .ralph-tui, .turbo, tasks to .prettierignore
- Files changed:
  - `.nvmrc` - Node version
  - `package.json` - engines, typescript, @types/node, typecheck script
  - `tsconfig.base.json` (new) - shared base config
  - `tsconfig.json` - extends base
  - `service/package.json` - typescript, jest upgrades, typecheck script
  - `service/tsconfig.json` - extends base, nodenext
  - `service/jest.config.js` - moduleNameMapper, transform
  - `service/src/index.ts` - .js import extension
  - `service/src/app.ts` - .js import extensions
  - `packages/express-app/package.json` - engines, typecheck script
  - `packages/express-app/tsconfig.json` - extends base
  - `packages/express-app/tsconfig.cjs.json` - extends base, commonjs override
  - `packages/express-app/tsconfig.esm.json` - extends base, nodenext
  - `packages/express-app/jest.config.js` - moduleNameMapper
  - `packages/express-app/src/index.ts` - .js import extensions, removed fs import, fixed openapi validator
  - `packages/express-app/src/middleware/index.ts` - .js import extensions
  - `packages/express-app/src/middleware/errorHandler.ts` - .js import extension
  - `packages/express-app/src/middleware/requestTracing.ts` - .js import extension
  - `packages/express-app/src/middleware/healthCheck.ts` - .js import extension
  - `web-app/package.json` - typescript, @types/node, typecheck script, build script (openssl-legacy-provider)
  - `web-app/tsconfig.json` - extends base, overrides module/moduleResolution for Webpack 4
  - `web-app/tsconfig.webpack.json` (new) - ES2017 target for Webpack 4
  - `web-app/webpack.config.js` - ts-loader configFile override
  - `.prettierignore` - added .ralph-tui, .turbo, tasks
- **Learnings:**
  - Jest 27.x is incompatible with Node 22 (`testEnvironmentOptions` undefined error in jest-environment-node). Must upgrade to Jest 29.x.
  - `module: "nodenext"` requires `.js` extensions on all relative imports in source code. This is a significant migration effort in large codebases.
  - web-app with Webpack 4 cannot use ES2022 target directly because Webpack 4's acorn parser doesn't support optional chaining (`?.`). Need separate tsconfig for webpack bundling.
  - Webpack 4 on Node 22 requires `NODE_OPTIONS=--openssl-legacy-provider` due to removal of legacy MD4 hash algorithm.
  - When `types` field is specified in tsconfig, TypeScript only looks for those specific type packages in `typeRoots`. If they're hoisted, `typeRoots` must point to root.
  - web-app still uses `module: "commonjs"` / `moduleResolution: "node"` since it's bundled with Webpack 4. Full nodenext migration will happen with Vite migration (US-006).
---

## 2026-02-13 - US-008
- What was implemented:
  - Upgraded ESLint from v8.34.0 to v9.39.2
  - Upgraded from @typescript-eslint/eslint-plugin v5 + @typescript-eslint/parser v5 to typescript-eslint v8 (unified package)
  - Replaced all .eslintrc (JSON) files with a single root eslint.config.mjs (flat config format)
  - Removed .eslintignore (ignores now in flat config)
  - Installed and configured: @eslint/js, typescript-eslint, eslint-config-prettier v10, eslint-plugin-react (latest), eslint-plugin-react-hooks (latest), eslint-plugin-jsx-a11y (latest), globals
  - Removed old packages: @typescript-eslint/eslint-plugin, @typescript-eslint/parser, eslint-plugin-import, eslint-plugin-jest, eslint-plugin-node, eslint-plugin-promise, eslint-plugin-standard
  - Removed eslint-plugin-react from web-app devDependencies (now at root)
  - Configured React-specific lint rules (react, react-hooks, jsx-a11y) for web-app
  - Prettier integration maintained via eslint-config-prettier v10
  - Updated lint-staged config to use `--no-warn-ignored` flag and target specific file extensions
  - Fixed auto-fixable issues (unused eslint-disable directives in errorHandler.ts and client/index.ts)
  - Fixed root jest.config.js circular self-require (unused `baseConfig` variable)
  - Fixed web-app/jest.config.js duplicate `rootDir` key
  - Renamed destructured unused `projects` to `_projects` in service and web-app jest configs
  - Added eslint-disable for react-hooks/immutability in renderApp.tsx (legitimate SSR pattern)
- Files changed:
  - `package.json` - devDependencies (ESLint v9, typescript-eslint v8, new plugins), lint-staged config
  - `eslint.config.mjs` (new) - root flat config replacing all .eslintrc files
  - `.eslintrc` (deleted) - old root config
  - `.eslintignore` (deleted) - moved to flat config ignores
  - `service/.eslintrc` (deleted) - replaced by root flat config
  - `web-app/.eslintrc` (deleted) - replaced by root flat config
  - `web-app/package.json` - removed eslint-plugin-react devDependency
  - `jest.config.js` - removed unused `baseConfig` require
  - `service/jest.config.js` - renamed `projects` to `_projects` in destructuring
  - `web-app/jest.config.js` - renamed `projects` to `_projects`, removed duplicate `rootDir`
  - `web-app/src/client/renderApp.tsx` - added eslint-disable for react-hooks/immutability
  - `packages/express-app/src/middleware/errorHandler.ts` - prettier auto-fixed (removed stale eslint-disable)
  - `web-app/src/client/index.ts` - prettier auto-fixed (removed stale eslint-disable)
- **Learnings:**
  - ESLint v9 flat config uses file-pattern-based objects instead of cascading `.eslintrc` files. A single root config can handle the entire monorepo by using `files` patterns like `['web-app/src/**/*.tsx']`.
  - The `typescript-eslint` v8 package is a unified replacement for the separate `@typescript-eslint/parser` and `@typescript-eslint/eslint-plugin` packages. Import as `import tseslint from 'typescript-eslint'` and use `tseslint.config()` helper.
  - CommonJS config files (jest.config.js, etc.) need both `globals.node` and `globals.commonjs` in the flat config to avoid `no-undef` errors for `module`, `require`, `__dirname`.
  - In flat config, `.eslintignore` is replaced by an ignores-only config object at the start of the config array.
  - `eslint-config-prettier` v10 works with flat config by simply including it in the config array (no more `"extends": ["prettier"]`).
  - `eslint-plugin-react-hooks` in v5+ includes a new `immutability` rule that flags mutations of external variables (like `delete window.__PRELOADED_STATE__`). This is a legitimate SSR cleanup pattern that needs an inline disable.
  - lint-staged with ESLint v9 should use `eslint --no-warn-ignored` and match specific file extensions rather than running `eslint .` which tries to lint non-JS files.
  - Old plugins like `eslint-plugin-node`, `eslint-plugin-standard`, `eslint-plugin-promise` are no longer needed - their useful rules are covered by `@eslint/js` recommended config.
---

## 2026-02-13 - US-005
- What was implemented:
  - Migrated service package from Jest to Vitest for testing
  - Replaced nodemon with tsx watch for dev mode (faster TypeScript execution)
  - Upgraded dependencies: supertest 6.x -> 7.x, rimraf 3.x -> 5.x, removed ts-node, ts-jest, @types/jest, @types/supertest
  - Added tsx as dev dependency for fast TS execution
  - Added vitest as dev dependency (v3.x) with vitest.config.ts
  - Added engines field (`>= 22`) to service package.json
  - Removed service/jest.config.js (replaced by vitest.config.ts)
  - Removed service/nodemon.json (replaced by tsx watch in dev script)
  - Updated root jest.config.js to remove service project reference
  - Updated eslint.config.mjs to remove `globals.jest` from service-specific config and include test files
  - Migrated test file to use explicit Vitest imports (`import { describe, it, expect } from 'vitest'`)
  - Added `.js` extension to test import path for nodenext compatibility
  - Service already used local `@dhruv-m-patel/express-app` workspace dependency (from US-003)
  - Service already used shared tsconfig.base.json (from US-002)
- Files changed:
  - `service/package.json` - upgraded deps, removed Jest/nodemon/ts-node, added vitest/tsx, updated scripts
  - `service/vitest.config.ts` (new) - Vitest configuration with node environment
  - `service/jest.config.js` (deleted) - replaced by vitest.config.ts
  - `service/nodemon.json` (deleted) - replaced by tsx watch script
  - `service/tests/integration/routes/health.test.ts` - migrated to Vitest imports
  - `jest.config.js` - removed service project reference
  - `eslint.config.mjs` - removed jest globals from service config, added test files glob
- **Learnings:**
  - Vitest works seamlessly with `module: "nodenext"` TypeScript configs - no special `moduleNameMapper` needed unlike Jest/ts-jest. Vitest handles `.js` -> `.ts` resolution natively via Vite's module resolution.
  - When migrating from Jest to Vitest, explicit imports (`import { describe, it, expect } from 'vitest'`) are cleaner than `globals: true` because they don't require type augmentation in tsconfig and make dependencies explicit.
  - tsx watch mode (`tsx watch --clear-screen=false -r dotenv/config src/index.ts`) is a drop-in replacement for nodemon + ts-node that's significantly faster and requires zero configuration (no nodemon.json needed).
  - When a package in a monorepo switches from Jest to Vitest, remember to update the root jest.config.js to remove the package's project reference, and clean up `globals.jest` from the ESLint config for that package.
  - Vitest v3.x pulls in Vite as a dependency - this is expected and doesn't conflict with the rest of the monorepo.
---

## 2026-02-13 - US-006
- What was implemented:
  - Migrated web-app from Webpack 4 + SSR to Vite 6 SPA
  - Upgraded React from 16.14 to 19.0 with new JSX transform (`jsx: "react-jsx"`)
  - Upgraded React Router from v5 (`Switch`/`Route`) to v7 (`Routes`/`Route` with `element` prop)
  - Replaced Redux (redux, react-redux, redux-api-middleware) with React Context + `useReducer` hook
  - Created `MessageContext` with provider and `useMessage` hook for API state management
  - Removed Material-UI v4 (`@material-ui/core`, `@material-ui/icons`) - replaced with plain CSS
  - Removed SSR infrastructure: Express server, `renderPage.tsx` middleware, `@loadable/component`, `@dhruv-m-patel/web-app`, `bluebird`
  - Removed all old dependencies: `core-js`, `clsx`, `fast-deep-equal`, `store`, `react-helmet-async`, `dotenv`, storybook v6, stylelint, nodemon, ts-node, ts-loader, webpack-cli
  - Moved from `src/client/index.ts` + `src/server/` to `src/main.tsx` Vite entry point
  - Created `index.html` at web-app root (Vite convention) with `<script type="module">` pointing to entry
  - Created `vite.config.ts` with `@vitejs/plugin-react`
  - Created `vitest.config.ts` with jsdom environment
  - Migrated tests from Jest 27 to Vitest 3.x with `@testing-library/react` v16
  - Updated `tsconfig.json`: `module: "ESNext"`, `moduleResolution: "bundler"`, `jsx: "react-jsx"`
  - Removed `tsconfig.webpack.json` (no longer needed)
  - Removed `nodemon.json` (no longer needed)
  - Removed `jest.config.js` (replaced by vitest.config.ts)
  - Removed `webpack.config.js` (replaced by vite.config.ts)
  - Updated root `jest.config.js` to remove web-app project reference
  - Updated `eslint.config.mjs`: added `react/react-in-jsx-scope: off` for React 19, removed `globals.jest` from web-app config, added Vite config files section, added `**/dist/` to ignores
  - Updated `.gitignore` to include `dist/`
  - Added `"type": "module"` to web-app `package.json`
  - All quality checks pass: `yarn build`, `yarn lint`, `yarn test`, `yarn typecheck`
- Files changed:
  - `web-app/package.json` - complete rewrite (new deps, scripts, type: module)
  - `web-app/vite.config.ts` (new) - Vite configuration with React plugin
  - `web-app/vitest.config.ts` (new) - Vitest configuration with jsdom
  - `web-app/index.html` (new) - Vite entry HTML at project root
  - `web-app/tsconfig.json` - updated for Vite (ESNext, bundler, react-jsx)
  - `web-app/src/main.tsx` (new) - Vite client entry point with createRoot
  - `web-app/src/App.tsx` (new) - root component with BrowserRouter + Routes
  - `web-app/src/context/MessageContext.tsx` (new) - React Context replacement for Redux
  - `web-app/src/pages/HomePage.tsx` (new) - rewritten without Material-UI/Redux connect
  - `web-app/src/pages/HomePage.css` (new) - plain CSS styles
  - `web-app/src/pages/HomePage.test.tsx` (new) - Vitest + RTL tests
  - `web-app/src/setupTests.ts` - updated for Vitest + explicit cleanup
  - `web-app/webpack.config.js` (deleted)
  - `web-app/tsconfig.webpack.json` (deleted)
  - `web-app/nodemon.json` (deleted)
  - `web-app/jest.config.js` (deleted)
  - `web-app/src/client/` (deleted) - old client entry, redux store, actions, reducers
  - `web-app/src/server/` (deleted) - old Express SSR server
  - `web-app/src/common/` (deleted) - old router and components
  - `web-app/src/lib/` (deleted) - old utility functions
  - `jest.config.js` - removed web-app project reference
  - `eslint.config.mjs` - React 19 rules, removed jest globals for web-app, added dist ignores
  - `.gitignore` - added dist/
- **Learnings:**
  - Vite's `index.html` must be at project root, not in `src/` or `public/`. The entry script is referenced with `<script type="module" src="/src/main.tsx">`.
  - When migrating from SSR (Express + React SSR) to Vite SPA, the entire server directory can be removed. Vite has its own dev server with HMR.
  - React 19's new JSX transform (`jsx: "react-jsx"`) eliminates the need for `import React from 'react'` in every file. ESLint needs `react/react-in-jsx-scope: off`.
  - React Router v7 replaces `Switch` with `Routes`, removes `component` prop in favor of `element` (JSX), and removes `exact` (all routes are exact by default).
  - `@testing-library/react` v16 with Vitest (globals: false) does NOT auto-cleanup between tests. You must add explicit `afterEach(() => cleanup())` in setupTests.
  - `@testing-library/dom` is a peer dependency of `@testing-library/react` that Yarn 3 doesn't auto-hoist. Must explicitly list it in devDependencies.
  - Vitest 3.x bundles its own Vite version (7.x) which can differ from the installed `vite` package (6.x). The `@vitejs/plugin-react` types may conflict. Use `defineConfig` from `vitest/config` with a type cast for the plugin.
  - `moduleResolution: "bundler"` is the correct setting for Vite projects - it allows extensionless imports and handles both ESM and CJS, unlike "nodenext" which requires `.js` extensions.
  - When converting from `useReducer` replacing Redux, the `useCallback` wrapper for async dispatch functions prevents unnecessary re-renders in consumers.
---

## 2026-02-13 - US-007
- What was implemented:
  - Migrated web-app styling from plain CSS to Tailwind CSS v4 + shadcn/ui
  - Installed `tailwindcss` v4.1.18, `@tailwindcss/vite` plugin, `class-variance-authority`, `clsx`, `tailwind-merge`, `lucide-react`
  - Created `src/index.css` with Tailwind v4 `@theme {}` config for colors, typography, spacing, border radius
  - Full dark mode support via `.dark` class toggle with `@custom-variant dark` and `ThemeContext` provider
  - Created shadcn/ui-style components: `Card`, `CardHeader`, `CardTitle`, `CardContent`, `CardDescription`, `CardFooter`, `Button` (with variants via CVA)
  - Created `cn()` utility (`clsx` + `tailwind-merge`) at `src/lib/utils.ts`
  - Created `Layout` component with sticky header (navbar with app title + dark mode toggle) and footer
  - Created `ThemeContext` with `useTheme` hook, persists preference to localStorage, respects system `prefers-color-scheme`
  - Restyled `HomePage` using Tailwind utility classes and shadcn `Card` components, with responsive 1/2/3 column grid
  - Added `@/` path alias in `vite.config.ts`, `vitest.config.ts`, and `tsconfig.json`
  - Removed old `HomePage.css` (replaced by Tailwind utilities)
  - Updated `index.html` to use Inter font instead of Roboto
  - Replaced Storybook card with Tailwind CSS card in features list
  - Added `dist` to `.prettierignore` (build artifacts)
  - All quality checks pass: `yarn build`, `yarn lint`, `yarn test`, `yarn typecheck`
- Files changed:
  - `web-app/package.json` - added tailwindcss, @tailwindcss/vite, class-variance-authority, clsx, tailwind-merge, lucide-react
  - `web-app/vite.config.ts` - added @tailwindcss/vite plugin and @/ path alias
  - `web-app/vitest.config.ts` - added @/ path alias and css: true
  - `web-app/tsconfig.json` - added baseUrl and paths for @/ alias
  - `web-app/index.html` - switched from Roboto to Inter font
  - `web-app/src/index.css` (new) - Tailwind v4 theme config with light/dark mode colors
  - `web-app/src/main.tsx` - added index.css import
  - `web-app/src/App.tsx` - added ThemeProvider and Layout wrapper
  - `web-app/src/lib/utils.ts` (new) - cn() utility function
  - `web-app/src/components/ui/card.tsx` (new) - shadcn/ui Card component
  - `web-app/src/components/ui/button.tsx` (new) - shadcn/ui Button component with CVA variants
  - `web-app/src/components/Layout.tsx` (new) - layout with header, dark mode toggle, footer
  - `web-app/src/context/ThemeContext.tsx` (new) - dark mode context and useTheme hook
  - `web-app/src/pages/HomePage.tsx` - restyled with Tailwind + shadcn Card, data-driven feature list
  - `web-app/src/pages/HomePage.test.tsx` - updated to test new feature cards including Tailwind CSS
  - `web-app/src/pages/HomePage.css` (deleted) - replaced by Tailwind utilities
  - `.prettierignore` - added dist directory
  - `jest.config.js` - formatted with prettier (pre-existing issue)
- **Learnings:**
  - Tailwind CSS v4 eliminates `tailwind.config.js` entirely. All theme configuration goes in CSS via `@theme {}` blocks. This is a major shift from v3 where JS config was the norm.
  - The `@tailwindcss/vite` plugin replaces the PostCSS plugin for Vite projects. Just add it to the Vite plugins array alongside `@vitejs/plugin-react`.
  - Dark mode in Tailwind v4 with class-based toggle requires `@custom-variant dark (&:is(.dark *))` in the CSS file. Color overrides go in a plain `.dark {}` selector that reassigns the CSS custom properties.
  - shadcn/ui components work with Tailwind v4 by using CSS custom properties (e.g., `bg-card`, `text-primary`). The semantic color names map to `--color-*` variables defined in `@theme {}`.
  - The `jsx-a11y/heading-has-content` ESLint rule doesn't understand `{...props}` spreading children on heading elements in `forwardRef` components. Must explicitly destructure `children` and render it as a child node.
  - When using path aliases like `@/` in a Vite + Vitest setup, you need to configure the alias in three places: `vite.config.ts`, `vitest.config.ts`, and `tsconfig.json`. Vitest does NOT inherit the Vite config's resolve aliases when using a separate `vitest.config.ts`.
  - `lucide-react` is a lightweight, tree-shakeable icon library that pairs well with shadcn/ui. Icons like `Moon`, `Sun`, `ExternalLink` are imported individually.
  - Tailwind v4 uses oklch color space by default for its generated colors. Custom theme colors should also use oklch for consistency.
---

## 2026-02-13 - US-009
- What was implemented:
  - Upgraded Storybook to v8.6.15 with `@storybook/react-vite` framework (Vite builder)
  - Removed old Storybook v6 config files (`main.js`, `preview.js`, `preview-head.html`)
  - Created new `.storybook/main.ts` with `@storybook/react-vite` framework, `@/` path alias via `viteFinal`
  - Created new `.storybook/preview.ts` importing Tailwind CSS (`index.css`) for styled stories
  - Added `storybook` and `build-storybook` scripts to web-app `package.json`
  - Created CSF3 stories for Button component (10 stories: Default, Destructive, Outline, Secondary, Ghost, Link, Small, Large, Icon, Disabled) with autodocs
  - Created CSF3 stories for Card component (3 stories: Default, WithFooter, Simple) with autodocs
  - Created CSF3 stories for Layout component (2 stories: Default, WithContent) with ThemeProvider decorator
  - Created CSF3 stories for HomePage component (1 story: Default) with autodocs
  - Installed Storybook v8 packages: storybook, @storybook/react-vite, @storybook/react, @storybook/blocks, @storybook/addon-essentials, @storybook/addon-interactions, @storybook/addon-links, @storybook/test
  - Updated `tsconfig.json` to include `.storybook` directory
  - Updated `eslint.config.mjs` to add `storybook-static/` to ignores, and `.storybook/*.ts` to node globals config
  - Updated `.gitignore` and `.prettierignore` to exclude `storybook-static/`
  - Tailwind CSS v4 works within Storybook (theme, dark mode variables, utility classes)
  - shadcn/ui components (Button, Card) render correctly in Storybook with full styling
  - `yarn storybook` (dev), `yarn build-storybook`, `yarn build`, `yarn lint`, `yarn test`, `yarn typecheck` all pass
- Files changed:
  - `web-app/package.json` - added Storybook devDependencies and scripts
  - `web-app/.storybook/main.ts` (new) - Storybook v8 config with react-vite framework
  - `web-app/.storybook/preview.ts` (new) - Storybook preview with Tailwind CSS import
  - `web-app/.storybook/main.js` (deleted) - old v6 config
  - `web-app/.storybook/preview.js` (deleted) - old v6 config
  - `web-app/.storybook/preview-head.html` (deleted) - old v6 meta tags
  - `web-app/src/components/ui/button.stories.tsx` (new) - Button stories in CSF3
  - `web-app/src/components/ui/card.stories.tsx` (new) - Card stories in CSF3
  - `web-app/src/components/Layout.stories.tsx` (new) - Layout stories in CSF3
  - `web-app/src/pages/HomePage.stories.tsx` (new) - HomePage stories in CSF3
  - `web-app/tsconfig.json` - added `.storybook` to include array
  - `eslint.config.mjs` - added storybook-static to ignores, .storybook/*.ts to node globals
  - `.gitignore` - added storybook-static/
  - `.prettierignore` - added storybook-static
- **Learnings:**
  - Storybook v8 with `@storybook/react-vite` uses Vite as its builder natively - no separate `@storybook/builder-vite` package needed. The framework package bundles the builder.
  - When upgrading from Storybook v6 to v8, old `.storybook/main.js` files conflict with new `main.ts` files. Storybook loads `.js` first and ignores `.ts`, causing "MissingBuilderError". Must delete all legacy config files.
  - Tailwind CSS v4 works in Storybook by simply importing the app's `index.css` (containing `@import 'tailwindcss'` and `@theme {}`) in `.storybook/preview.ts`. The `@tailwindcss/vite` plugin is automatically available because Storybook's Vite builder resolves it from the project's dependencies.
  - The `@/` path alias must be configured in `.storybook/main.ts` via `viteFinal` callback, separate from the app's `vite.config.ts`. Storybook doesn't automatically inherit the app's Vite config.
  - CSF3 format uses `satisfies Meta<typeof Component>` for type-safe meta objects and `StoryObj<typeof meta>` for stories. Stories are plain objects with `args` or `render` functions - no more `Template.bind({})` pattern from CSF2.
  - Components using React Context (like `Layout` using `ThemeContext`) need decorators in their story meta to wrap stories with the required providers.
  - `@storybook/addon-a11y` was referenced in old v6 config but was never installed. v8 doesn't include it by default - it's a separate optional addon.
  - In Yarn 3 monorepos with Storybook, pinning to `^8` is important because the default `latest` tag may resolve to a newer major version (e.g., v10) causing peer dependency mismatches with v8 addons.
---

## 2026-02-13 - US-010
- What was implemented:
  - Migrated `packages/express-app` from Jest 29 to Vitest 3.x (last remaining Jest package)
  - Removed all Jest dependencies: `jest`, `ts-jest`, `ts-node`, `@types/jest` from express-app
  - Removed root `jest.config.js` and stale `jest.mock.js`
  - Removed `pretest: "jest --clearCache"` script from root package.json
  - Created `vitest.config.ts` for express-app with node environment and v8 coverage
  - Migrated 3 express-app test files (19 tests) from Jest to Vitest API (`vi.fn`, `vi.spyOn`, explicit imports)
  - Converted Jest `done` callback pattern to Vitest `return new Promise<void>()` pattern in runApp tests
  - Updated `packages/express-app/tsconfig.json` to remove `"jest"` from types array
  - Created `vitest.workspace.ts` at root with workspace support for all 3 packages
  - Added unit tests for service routes: `health.test.ts` (2 tests), `message.test.ts` (3 tests)
  - Added web-app unit tests: `ThemeContext.test.tsx` (7 tests), `MessageContext.test.tsx` (6 tests), `Layout.test.tsx` (5 tests), `button.test.tsx` (11 tests), `card.test.tsx` (14 tests), `utils.test.ts` (7 tests), `App.test.tsx` (3 tests)
  - Added `window.matchMedia` mock to web-app `setupTests.ts` for jsdom compatibility
  - Added `@testing-library/user-event` v14 to web-app devDependencies
  - Added `test:ci` script to web-app package.json
  - Configured consistent coverage reporting (text + text-summary + lcov) across all 3 packages
  - Updated `eslint.config.mjs`: removed `globals.jest` from all configs, added express-app test files, added vitest config files to node globals section
  - Total: 81 tests across 14 test files (19 express-app + 56 web-app + 6 service)
  - All quality checks pass: `yarn build`, `yarn lint`, `yarn test`, `yarn typecheck`
- Files changed:
  - `package.json` - removed `pretest` script
  - `jest.config.js` (deleted) - replaced by vitest workspace
  - `jest.mock.js` (deleted) - stale file
  - `vitest.workspace.ts` (new) - root Vitest workspace config
  - `eslint.config.mjs` - removed Jest globals, added express-app test files glob, added vitest config files
  - `packages/express-app/package.json` - replaced Jest with Vitest deps and scripts
  - `packages/express-app/jest.config.js` (deleted) - replaced by vitest.config.ts
  - `packages/express-app/vitest.config.ts` (new) - Vitest configuration
  - `packages/express-app/tsconfig.json` - removed "jest" from types
  - `packages/express-app/tests/configureApp.test.ts` - migrated to Vitest API
  - `packages/express-app/tests/middleware.test.ts` - migrated to Vitest API
  - `packages/express-app/tests/runApp.test.ts` - migrated to Vitest API (Promise pattern)
  - `service/vitest.config.ts` - updated coverage reporters
  - `service/tests/unit/routes/health.test.ts` (new) - health route unit test
  - `service/tests/unit/routes/message.test.ts` (new) - message route unit test
  - `web-app/package.json` - added @testing-library/user-event, test:ci script
  - `web-app/vitest.config.ts` - added coverage configuration
  - `web-app/src/setupTests.ts` - added window.matchMedia mock
  - `web-app/src/App.test.tsx` (new) - App component tests
  - `web-app/src/lib/utils.test.ts` (new) - cn() utility tests
  - `web-app/src/context/ThemeContext.test.tsx` (new) - theme context and hook tests
  - `web-app/src/context/MessageContext.test.tsx` (new) - message context and hook tests
  - `web-app/src/components/Layout.test.tsx` (new) - Layout component tests
  - `web-app/src/components/ui/button.test.tsx` (new) - Button component tests
  - `web-app/src/components/ui/card.test.tsx` (new) - Card component tests
- **Learnings:**
  - jsdom does not implement `window.matchMedia`. Components using `prefers-color-scheme` (like ThemeContext) need a mock in setupTests.ts. The mock must return an object with `matches`, `media`, and all MediaQueryList event methods.
  - When migrating Jest `done` callbacks to Vitest, return a `new Promise<void>()` from the test function instead. Vitest supports both patterns but the Promise approach is cleaner.
  - Vitest's `vi.spyOn(console, 'log').mockImplementation()` requires a function argument (e.g., `() => {}`) unlike Jest which accepts no arguments.
  - `vitest.workspace.ts` at the monorepo root enables running all workspace tests with a single `vitest run` command, but individual packages can still run tests independently with their own `vitest.config.ts`.
  - `@testing-library/user-event` v14 needs to be explicitly installed - it's not bundled with `@testing-library/react`. The `userEvent.setup()` pattern is required for v14+ (replaces direct `userEvent.click()` calls).
  - The `no-constant-binary-expression` ESLint rule catches `false && 'bar'` in tests as a constant truthiness issue. Use a variable (`const show = false; show && 'bar'`) to avoid the lint error while testing conditional class behavior.
---

## 2026-02-14 - US-011
- What was implemented:
  - Added Playwright E2E testing at root level with `@playwright/test` v1.58.2
  - Created `playwright.config.ts` at root with dual `webServer` config (Vite on port 3000, Express on port 4000)
  - Configured Chromium-only project for fast CI runs with headless mode
  - HTML report generated on failure (`playwright-report/`), traces on first retry
  - Added Vite proxy config (`server.proxy`) for `/api` requests forwarding to service on port 4000
  - E2E test: home page loads correctly (5 tests) - title, heading, feature cards, header with dark mode toggle, footer
  - E2E test: navigation (4 tests) - external links, unknown route handling, root path, layout structure persistence
  - E2E test: API health check (3 tests) - `/health` text endpoint, `/api/health` JSON endpoint, `/api/message` JSON endpoint
  - E2E test: web-app ↔ service communication (2 tests) - fetch message via Vite proxy, health check via proxy
  - Total: 14 E2E tests across 4 spec files, all passing
  - Added `yarn test:e2e` script to root `package.json` running `playwright test`
  - Updated `eslint.config.mjs`: added `playwright-report/` and `test-results/` to ignores, added `e2e/**/*.ts` and `**/*.spec.ts` to test files config, added `playwright.config.ts` to node globals, added E2E test files node globals section
  - Updated `.gitignore` and `.prettierignore` to exclude `playwright-report/` and `test-results/`
  - All quality checks pass: `yarn build`, `yarn lint`, `yarn test`, `yarn test:e2e`
- Files changed:
  - `package.json` - added `@playwright/test` devDependency, `test:e2e` script
  - `playwright.config.ts` (new) - Playwright configuration with dual webServer
  - `e2e/home-page.spec.ts` (new) - home page E2E tests (5 tests)
  - `e2e/navigation.spec.ts` (new) - navigation E2E tests (4 tests)
  - `e2e/api-health.spec.ts` (new) - API health check E2E tests (3 tests)
  - `e2e/web-app-service.spec.ts` (new) - web-app ↔ service communication E2E tests (2 tests)
  - `web-app/vite.config.ts` - added `server.proxy` for `/api` -> `http://localhost:4000`
  - `eslint.config.mjs` - added Playwright ignores, E2E test file configs, playwright.config.ts to node globals
  - `.gitignore` - added `playwright-report/`, `test-results/`
  - `.prettierignore` - added `playwright-report`, `test-results`
- **Learnings:**
  - Playwright's `webServer` config supports an array of servers, making it ideal for monorepos with separate frontend and backend. Each entry can have its own `command`, `url`, and `timeout`.
  - The service requires `bundle:api` to be run before `dev` because it references `build/api/api-spec.yaml` at runtime. Chain the commands with `&&` in the `webServer.command`.
  - Vite's `open: true` config tries to open a browser during E2E runs. Pass `-- --no-open` via the Playwright webServer command to prevent this.
  - When the web-app makes relative API calls (e.g., `fetch('/api/message')`), Vite's `server.proxy` is needed to forward these to the Express service running on a different port. Without this, the calls go to Vite's own server and return 404.
  - Playwright's `getByText()` with short strings like `'React'` can match multiple elements (headings, descriptions, footer). Use `getByRole('link', { name: /specific text/ })` for more precise matching in pages with rich content.
  - When a `<main>` element has no content (e.g., no matched route), Playwright's `toBeVisible()` fails because the element has no dimensions. Use `toBeAttached()` instead to verify DOM presence without requiring visual visibility.
  - Playwright in Yarn 3 workspaces: install `@playwright/test` at root level (not in a workspace package), and run `npx playwright install chromium` to download the browser binary. The `playwright test` command reads `playwright.config.ts` from the current directory.
  - The `reuseExistingServer: !process.env.CI` pattern allows reusing already-running dev servers locally (faster iteration) while always starting fresh in CI.
---

## 2026-02-14 - US-012
- What was implemented:
  - Added API performance testing using autocannon + Vitest for the service package
  - Created performance test infrastructure: helpers (server start/stop, load test runner, metrics extraction, threshold validation), reporter (JSON and markdown output)
  - Performance tests for all 3 API endpoints: `GET /health`, `GET /api/health`, `GET /api/message`
  - Metrics captured: p50, p97.5 (mapped as p95 - autocannon's closest percentile), p99 response times, average RPS, error rate
  - Per-endpoint baseline thresholds established and documented in test file
  - Tests fail if response times exceed thresholds or error rate is non-zero
  - Separate `vitest.perf.config.ts` ensures perf tests don't run during `yarn test`
  - `yarn test:perf` script at both service and root level
  - CI-parseable output: JSON report (`perf-results/perf-report.json`) with summary, per-endpoint results, and threshold violations
  - Vitest JSON reporter output (`perf-results/vitest-report.json`) for CI integration
  - Markdown summary generator (`generateMarkdownSummary`) for PR comment reporting
  - Updated ESLint config with `perf-results/` ignores and `vitest.perf.config.ts` in node globals
  - Updated `.gitignore` and `.prettierignore` with `perf-results/`
  - All quality checks pass: `yarn build`, `yarn lint`, `yarn test`, `yarn typecheck`
- Files changed:
  - `service/package.json` - added `autocannon`, `@types/autocannon` devDependencies, `test:perf` script
  - `service/vitest.config.ts` - added `exclude: ['tests/performance/**']` to avoid running perf tests in regular test suite
  - `service/vitest.perf.config.ts` (new) - separate Vitest config for performance tests with longer timeouts, serial execution, JSON reporter
  - `service/tests/performance/helpers.ts` (new) - server lifecycle, autocannon load test runner, metrics extraction, threshold validation, result formatting
  - `service/tests/performance/reporter.ts` (new) - JSON report generation, file writer, markdown summary for PRs
  - `service/tests/performance/api-endpoints.perf.test.ts` (new) - performance tests for all 3 API endpoints with per-endpoint thresholds
  - `package.json` - added `test:perf` root script
  - `eslint.config.mjs` - added `perf-results/` to ignores, `*.perf.test.ts` to test files, `vitest.perf.config.ts` to node globals
  - `.gitignore` - added `perf-results/`
  - `.prettierignore` - added `perf-results`
- **Learnings:**
  - Autocannon's Histogram interface does NOT include `p95` - it provides `p97_5` instead. The available percentiles are: p50, p75, p90, p97_5, p99, p99_9, p99_99, p99_999. Accessing `result.latency.p95` returns `undefined`.
  - Performance tests must be isolated from the regular test suite. Using `exclude` in the main vitest.config.ts and a separate `vitest.perf.config.ts` with `--config` flag is the clean approach. Without exclusion, `tests/**/*.test.ts` glob matches `tests/performance/*.perf.test.ts`.
  - Autocannon's programmatic API (`await autocannon({...})`) returns a `Result` object directly. No need for a callback or stream - the Promise-based API is clean and works well with Vitest's async test functions.
  - For performance tests, `pool: 'forks'` with `singleFork: true` ensures tests run serially in a single process. Load tests should not compete for CPU/network resources with each other.
  - The Express `app.listen(0)` pattern (port 0) lets the OS assign a random available port, which is ideal for test isolation. Extract the actual port from `server.address()` after listening.
  - Autocannon with 10 connections and 5-second duration produces ~38K-40K requests against a local Express server, with p50 latency of ~1ms. These are good baseline numbers for simple JSON endpoints.
---
